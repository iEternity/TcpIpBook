# 基于TCP的半关闭
## 单方面断开连接带来的问题
在A、B两个主机进行通信的过程中，A在发送了最后一条数据之后，直接调用close(sockFd);将套接字的读和写两个方向的输入流和输出流同时关闭，若在此时B主机正在向A主机发送数据那么这条数据将无法接收到。
## 套接字和流
两台主机一旦建立了连接之后，两台主机上会分别产生输入流和输出流，进行双向通信，一个主机的输入流与另一个主机的输出流相连，优雅的断开套接字即只断开一个方向上的数据流，而非同时断开输入、输出流。
## 针对优雅断开的shutdown函数
```
int shutdown(int sock, int howto);
//成功时返回0，失败时返回-1
```
howto:断开连接的方式，可能的取值如下：
- SHUT_RD:断开输入流
- SHUT_WR:断开输出流
- SHUT_RDWR:同时断开输入流和输出流
> 断开输入流时若输入缓冲中有数据则输入缓冲中的数据将会被清除，断开输出流时若输出缓冲中仍然有未发送的数据，则会将输出缓冲中的数据发送到对方主机中。